@using Quanlyduoc.Models;
@{
    ViewBag.Title = "Quản lý kho";
    Layout = "~/Areas/Admin/Views/Layout/AdminLayout.cshtml";
}

@{
    var account = Session["loginSession"] as TaiKhoan;
}
@section styles{
    <!-- Table -->
    <link href="~/Content/Admin/bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css" rel="stylesheet" />
    <link href="~/Areas/Admin/Content/css/quanlykho.css" rel="stylesheet" />
    <style>
        .example-modal .modal {
            position: relative;
            top: auto;
            bottom: auto;
            right: auto;
            left: auto;
            display: block;
            z-index: 1;
        }

        .example-modal .modal {
            background: transparent !important;
        }
    </style>
}
@section scripts{
    <!-- Table -->
    <script src="~/Content/Admin/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/Admin/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>

    <script>
        var scope;
        myapp = angular.module("myapp", []);
        myapp.controller('global', ['$scope', '$http', function ($scope, $http) {
            $scope.model = @Html.Raw(Json.Encode(Model.Data));
            $scope.maKho = null;
            $scope.JPhieuXuat = {};
            $scope.JCTPhieuXuat = {};
            $scope.model.JNguoiVanChuyen = {};
            $scope.hoaDonVanChuyen = {};



            //Xem thông tin các phần của kho
            $scope.xem = function () {
                if ($scope.maKho === null) {
                    alert("Chưa kho nào được chọn!")
                    $scope.JtonKho = {};
                    $scope.JhoaDonMua = {};
                    $scope.Jnhap = {};
                    $scope.Jxuat = {};
                    $scope.JnhanSu = {};
                    $scope.$applyAsync();
                }
                else {
                    $.ajax({type: "post",url: "Kho/layThongTinKho",
                        data: {
                            maKho: $scope.maKho
                        },
                        success: function (data) {
                            if (data.success === "success") {
                                $scope.JtonKho = data.JtonKho;
                                $scope.JhoaDonMua = data.JhoaDonMua;
                                $scope.Jnhap = data.Jnhap;
                                $scope.Jxuat = data.Jxuat;
                                $scope.Jquankho = data.Jquankho;
                                $scope.$applyAsync();
                            }
                            else {
                                $scope.JtonKho = {};
                                $scope.JhoaDonMua = {};
                                $scope.Jnhap = {};
                                $scope.Jxuat = {};
                                $scope.Jquankho = {};
                                $scope.$applyAsync();
                                swal(data.msg, "", "error");
                            }

                        }
                    });
                }
            };

            //Hàm chuyển đổi đơn vị
            function convertSoLuongCon(maDT, MaDonViOld, MaDonViNew, SoLuongCon)
            {
                var JDonVi = $scope.JtonKho.find(t => t.MaDT === maDT).JDonVi;
                var IndexOld = JDonVi.findIndex(dv => dv.ID === MaDonViOld);
                var IndexNew = JDonVi.findIndex(dv => dv.ID === MaDonViNew);

                var SLC = 0;
                if(MaDonViOld === MaDonViNew)
                {
                    SLC = SLC + SoLuongCon;
                }
                    else
                {
                    if (IndexNew > IndexOld) {
                        var ID = 0;
                        //Tính hệ số
                        var heso = 1;
                        var k = IndexNew;
                        do {
                            ID = JDonVi[k].IDParent;
                            heso = heso * JDonVi[k].Heso;
                            k--;
                        }
                        while (ID != MaDonViOld);
                        SLC = SLC + SoLuongCon * heso;
                    }
                    else {
                        var ID = 0;
                        //Tính hệ số
                        var heso = 1;
                        var k = IndexOld;
                        do {
                            ID = JDonVi[k].IDParent;
                            heso = heso / JDonVi[k].Heso;
                            k--;
                        }
                        while (ID != MaDonViNew);
                        SLC = SLC + SoLuongCon * heso;
                    }

                }
                return SLC;
            }

            //Chuyển đổi đơn vị
            $scope.getMaDonViOld = function (maDonViOld) {
                $scope.maDonViOld = maDonViOld;
            }
            //Chuyển đơn vị
            $scope.chuyenDonVi = function (index, maDauThuoc, maDonViNew, soLuongCon) {
                var SLC = convertSoLuongCon(maDauThuoc, $scope.maDonViOld, maDonViNew, soLuongCon);
                //var tonKho1 = $scope.JtonKho.find(t => t.MaDT === maDauThuoc);
                //var tonKho2 = angular.copy($scope.JtonKho.find(t => t.MaDT === maDauThuoc));
                var tonKho1 = $scope.JtonKho[index];
                var tonKho2 = angular.copy($scope.JtonKho[index]);
                tonKho2.SoLuongCon = SLC;
                angular.extend(tonKho1, tonKho2);
                $scope.$applyAsync();
            }

            //Thêm kho
            $scope.taoFormThem = function () {
                $scope.Kho = {};
            }
            $scope.themKho = function () {
                var Kho = JSON.stringify($scope.Kho);
                $.ajax({
                    type: "post",
                    url: "Kho/themKho",
                    data: Kho,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.success === "success") {
                            $scope.model.JKho.push($scope.Kho);
                            $scope.$applyAsync();
                            swal({
                                type: data.success,
                                title: data.msg,
                                showConfirmButton: true,
                                timer: 1500
                            });
                            $("#modal-default1").modal("hide");

                        }
                        else {
                            swal(data.msg, "", data.success);
                        }
                    }
                });
            };

            //Sửa kho
            $scope.taoFormSua = function (maKho) {
                $scope.editKho = angular.copy($scope.model.JKho.find(kho => kho.MaKho == maKho));
                $("#modal-default-edit-kho").modal("show");
            }
            $scope.capNhatKho = function () {
                var kho = JSON.stringify($scope.editKho);
                var updateKho = $scope.model.JKho.find(kho => kho.MaKho == $scope.editKho.MaKho);
                $.ajax({
                    type: "post",
                    url: "Kho/suakho",
                    data: kho,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.success === "success") {
                            angular.extend(updateKho, $scope.editKho);
                            $scope.$applyAsync();
                            swal({
                                type: data.success,
                                title: data.msg,
                                showConfirmButton: true,
                                timer: 1500
                            });
                            $("#modal-default-edit-kho").modal("hide");

                        }
                        else {
                            swal(data.msg, "", data.success);
                        }
                    }
                });
            };

            //Xóa hóa đơn nhập
            $scope.loadModalXoaHDN = function (maHoaDon) {
                $scope.maHoaDonNhap = maHoaDon;
                $("#modal-danger4").modal("show");
            };
            $scope.xoaHoaDonNhap = function () {
                var index = $scope.Jnhap.findIndex(hd => hd.MaHD === $scope.maHoaDonNhap);
                $.ajax({
                    type: "post",
                    url: "HoaDonNhap/xoahoadonnhap",
                    data: {
                        mahoadon: $scope.maHoaDonNhap
                    },
                    success: function (data) {
                        if (data.success === "success") {
                            $scope.Jnhap.splice(index, 1);
                            $scope.$applyAsync();
                            swal({
                                type: data.success,
                                title: data.msg,
                                showConfirmButton: true,
                                timer: 1500
                            });
                            $("#modal-danger4").modal("hide");
                        }
                        else {
                            swal(data.msg, "", data.success);
                        }
                    }
                });
            }

            //Tạo phiếu xuất
            $scope.taoPhieuXuat = function (maHoaDon) {
                $scope.JPhieuXuat = {};
                $scope.maHoaDon = maHoaDon;
                var hoaDonMua = angular.copy($scope.JhoaDonMua.find(hd => hd.MaHD === maHoaDon));
                $.ajax({
                    type: "post",
                    url: "HoaDonXuat/taoPhieuXuat",
                    data: {
                        maHoaDon: maHoaDon
                    },
                    success: function (data) {
                        if (data.success === "success") {
                            $scope.JPhieuXuat.TenKho = hoaDonMua.TenKho;
                            $scope.JPhieuXuat.TenKhachHang = hoaDonMua.TenKH;
                            $scope.JPhieuXuat.NgayXuat = new Date();

                            $scope.JCTPhieuXuat = data.JCTPhieuXuat;
                            $scope.$applyAsync();
                            $("#modal-default2").modal();// "toggle"
                        }
                        else {
                            swal(data.msg, "", data.success);
                        }
                    }
                });
            };

            //Lưu hóa đơn xuất
            $scope.luuPhieuXuat = function () {
                var maHoaDon = $scope.maHoaDon;
                var index = $scope.JhoaDonMua.findIndex(hd => hd.MaHD === maHoaDon);
                $.ajax({
                    type: "post",
                    url: "HoaDonXuat/luuPhieuXuat",
                    data: {
                        maHoaDon: maHoaDon
                    },
                    success: function (data) {
                        if (data.success === "success") {
                            $scope.JhoaDonMua.splice(index, 1);
                            $scope.$applyAsync();
                            swal(data.msg, "", data.success);
                            $("#modal-default2").modal("hide");
                        }
                        else {
                            swal(data.msg, "", data.success);
                        }
                    }
                });
            };

            //Xóa hóa đơn xuất
            $scope.loadModalXoaHDX = function (maHoaDon) {
                $scope.maHoaDon = maHoaDon;
            };
            $scope.xoaHoaDonXuat = function () {
                var index = $scope.Jxuat.findIndex(hd => hd.MaHD === $scope.maHoaDon);
                $.ajax({
                    type: "post",
                    url: "HoaDonXuat/xoaHoaDonXuat",
                    data: {
                        maHoaDon: $scope.maHoaDon
                    },
                    success: function (data) {
                        if (data.success === "success") {
                            $scope.Jxuat.splice(index, 1);
                            $scope.$applyAsync();
                            swal({
                                type: data.success,
                                title: data.msg,
                                showConfirmButton: true,
                                timer: 1500
                            });
                            $("#modal-danger3").modal("hide");
                        }
                        else {
                            swal(data.msg, "", data.success);
                        }
                    }
                });
            }

            //Kiểm tra trạng thái hóa đơn xuất nếu == 1 chưa chuyể, ==2 đang vận chuyển, nếu == 3 đã hoàn thành
            $scope.kiemTraTrangThaiVanChuyen = function (maHoaDon) {
                $scope.model.JNguoiVanChuyen = {};
                $scope.hoaDonVanChuyen = {};

                $scope.maHoaDon = maHoaDon;
                $scope.hoaDonVanChuyen.maNguoiVanChuyen = "";
                $scope.hoaDonVanChuyen.ngayGioVanChuyen = new Date();
                $.ajax({
                    type: "post", url: "HoaDonXuat/kiemTraTrangThaiVanChuyen",
                    data: { maHoaDon: maHoaDon },
                    success: function (data) {
                        if (data.success === "success") {
                            $("#modal-default3").modal("toggle");
                            $scope.model.JNguoiVanChuyen = data.JNguoiVanChuyen;
                            $scope.$applyAsync();
                        }
                        else {
                            swal(data.msg, "", data.success);
                        }

                    }
                });
            };

            //Chọn người vận chuyển
            $scope.chonNguoiVanChuyen = function () {
                var hoaDonX1 = angular.copy($scope.Jxuat.find(hd => hd.MaHD === $scope.maHoaDon));
                var hoaDonX2 = $scope.Jxuat.find(hd => hd.MaHD === $scope.maHoaDon);
                var nguoiVanChuyen = $scope.model.JNguoiVanChuyen.find(v => v.MaNguoiVanChuyen === $scope.hoaDonVanChuyen.maNguoiVanChuyen);
                //var hoaDonVanChuyen = JSON.stringify($scope.hoaDonVanChuyen);
                var Jhdvc = JSON.stringify({
                    "Jhdvc": {
                        "maHoaDon": $scope.maHoaDon,
                        "hoaDonVanChuyen": $scope.hoaDonVanChuyen
                    }
                });
                $.ajax({
                    type: "post",
                    url: "/HoaDonVanChuyen/ThemHoaDonVanChuyen",
                    data: Jhdvc,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        if (data.success === "add") {
                            hoaDonX1.NguoiVanChuyen = nguoiVanChuyen.HoTen;
                            hoaDonX1.MaHoaDonVanChuyen = data.maHoaDonVanChuyen;
                            angular.extend(hoaDonX2, hoaDonX1);
                            $scope.$applyAsync();
                            swal(data.msg, "", "success");
                            $("#modal-default3").modal("hide");
                        }
                        else
                            if (data.success === "edit") {
                                hoaDonX1.NguoiVanChuyen = nguoiVanChuyen.HoTen;
                                angular.extend(hoaDonX2, hoaDonX1);
                                $scope.$applyAsync();

                                $("#modal-default1").modal("hide");
                            }
                            else {
                                swal(data.msg, "", "success");
                            }
                    }
                });
            };

            scope = $scope;
        }]);
    </script>
    <script>
        $(function () {
            //$('#example1, #example2, #example3, #example4, #example5').DataTable()
            $('#example1, #example2, #example3, #example4, #example5 ').DataTable({
                'paging': true,
                'lengthChange': false,
                'searching': false,
                'ordering': true,
                'info': false,
                'autoWidth': false
            })
        })
    </script>
}
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="row">
            <h1 class="col-xs-6 col-sm-6 col-lg-3">
                Quản lý kho
            </h1>
            <button class="btn btn-primary" data-toggle="modal" data-target="#modal-default" style="width: 120px; margin-bottom: 5px;">Danh sách kho</button>
            <select ng-change="xem()" class="col-xs-6 col-sm-6 col-lg-3" ng-options="item.MaKho as item.TenKho for item in model.JKho" ng-model="maKho">
                <option value="">--- Chọn kho ---</option>
            </select>
        </div>
    </section>

    <div style="clear:both;"></div>
    <!-- Main content -->
    <section class="content">

        @* Modal List Kho modal-default*@
        <div class="modal fade" id="modal-default">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #367fa9; color: #fff;">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <button class="btn btn-primary" data-toggle="modal" data-target="#modal-default1" ng-click="taoFormThem()" style="background-color: #fff; color: #0e689c;">Thêm kho</button>
                    </div>
                    <div class="modal-body">
                        <table id="" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Tên kho</th>
                                    <th>Địa chỉ</th>
                                    <th>Số điện thoại</th>
                                    <td></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in model.JKho">
                                    <td class="col-md-3 col-xs-3"><a href="#">{{item.TenKho}}</a></td>
                                    <td class="col-md-5 col-xs-5">{{item.DiaChi}}</td>
                                    <td class="col-md-3 col-xs-3">{{item.SDT}}</td>
                                    <td class="col-md-1 col-sm-1" style="text-align: center;">
                                        <a href='' ng-click="taoFormSua(item.MaKho)" style="padding: 0px 5px; font-size: 16px;"> <i class="fa fa-pencil"></i></a>
                                        <a href='' ng-click="" data-toggle="modal" data-target="#modal-danger1" style="padding: 0px 5px; font-size: 17px; color: red;"><i class="fa fa-trash-o"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default center-block" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./List Modal Kho*@

        @* Modal Add Kho modal-default1*@
        <div class="modal fade" id="modal-default1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #367fa9; color: #fff;">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h3 class="modal-title">Thêm kho {{Kho.TenKho}}</h3>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="">Tên kho:</label>
                            <input name="tenKho" class="form-control" ng-model="Kho.TenKho" />
                        </div>
                        <div class="form-group">
                            <label for="">Địa chỉ:</label>
                            <input name="diaChi" class="form-control" ng-model="Kho.DiaChi" />
                        </div>
                        <div class="form-group">
                            <label for="">Số điện thoại:</label>
                            <input id="SDT" class="form-control" ng-model="Kho.SDT" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" ng-click="themKho()">Thêm</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./add Modal Kho*@

        @* Modal Add Kho modal-default1*@
        <div class="modal fade" id="modal-default-edit-kho">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header" style="background-color: #367fa9; color: #fff;">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                        <h3 class="modal-title">Sửa kho {{editKho.TenKho}}</h3>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="">Tên kho:</label>
                            <input name="tenKho" class="form-control" ng-model="editKho.TenKho" />
                        </div>
                        <div class="form-group">
                            <label for="">Địa chỉ:</label>
                            <input name="diaChi" class="form-control" ng-model="editKho.DiaChi" />
                        </div>
                        <div class="form-group">
                            <label for="">Số điện thoại:</label>
                            <input id="SDT" class="form-control" ng-model="editKho.SDT" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary" ng-click="capNhatKho()">Lưu</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./add Modal Kho*@

        @* NHẬP *@
        @* Modal Delete hóa đơn nhập modal-danger3*@
        <div class="modal modal-danger fade" id="modal-danger4">
            <div class="modal-dialog">
                <form>
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">Xác nhận thao tác xóa</h4>
                        </div>
                        <div class="modal-body">
                            <h3>Bạn có muốn xóa hóa đơn này?</h3>
                        </div>
                        <div class="modal-footer">
                            <input class="btn btn-outline pull-left" data-dismiss="modal" value="Hủy" style="width: 50px;">
                            <button type="submit" class="btn btn-outline" ng-click="xoaHoaDonNhap()" data-dismiss="modal">Thực hiện xóa</button>
                        </div>
                    </div>
                </form>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./Modal xóa hóa đơn nhập*@

        @* XUẤT *@
        @* Tạo phiếu xuất model modal-default2*@
        <div class="modal fade" id="modal-default2">
            <div class="modal-dialog" style="width: 65%;">
                <form novalidate>
                    <div class="modal-content">
                        <div class="modal-header" style="background-color: #367fa9; color: #fff;">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h3 class="modal-title"> Tạo phiếu xuất</h3>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <!-- left column -->
                                <div class="col-md-6">
                                    <div class="">
                                        <div class="">
                                            <div class="form-group">
                                                <label for="">Kho</label>
                                                <input type="text" class="form-control" ng-model="JPhieuXuat.TenKho" placeholder="Mã kho" readonly>
                                            </div>
                                            <div class="form-group">
                                                <label for="">Người xuất</label>
                                                <input type="text" class="form-control" value="@account.HoTen" placeholder="Người xuất" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--/.col (left) -->
                                <!-- right column -->
                                <div class="col-md-6">
                                    <div class="">
                                        <div class="">
                                            <div class="form-group">
                                                <label for="">Khách hàng</label>
                                                <input type="text" class="form-control" ng-model="JPhieuXuat.TenKhachHang" placeholder="Khách hàng" readonly>
                                            </div>
                                            <div class="form-group">
                                                <label for="">Ngày xuất</label>
                                                <input type="text" class="form-control" ng-model="JPhieuXuat.NgayXuat" placeholder="Ngày xuất" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--/.col (right) -->
                            @*<script src="~/Areas/Admin/Content/js/themhoadon.js"></script>*@
                            <!-- /.row -->

                            <div class="row">
                                <!-- left column -->
                                <div class="col-md-12">
                                    <div class="box box-primary">
                                        <div class="box-body">
                                            <table id="" class="table table-bordered table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>STT</th>
                                                        <th>Đầu thuốc</th>
                                                        <th>Số lượng</th>
                                                        <th>Đơn vị</th>
                                                        <th>Đơn giá</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="item in JCTPhieuXuat">
                                                        <td class="col-md-1 col-xs-1"><a href="#">{{JCTPhieuXuat.indexOf(item) + 1}}</a></td>
                                                        <td class="col-md-3 col-xs-3">{{item.DauThuoc}}</td>
                                                        <td class="col-md-2 col-xs-2">{{item.SoLuong}}</td>
                                                        <td class="col-md-2 col-xs-2">{{item.TenDonVi}}</td>
                                                        <td class="col-md-2 col-xs-2">{{item.DonGia}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Đóng</button>
                            <button type="submit" class="btn btn-primary" ng-click="luuPhieuXuat()">Lưu hóa đơn</button>
                        </div>
                    </div>
                </form>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./Tạo phiếu xuất Modal *@

        @* Chọn người vận chuyển model modal-default3*@
        <div class="modal fade" id="modal-default3">
            <div class="modal-dialog" style="width: 370px; top: 80px; left: 260px;">
                <form novalidate>
                    <div class="modal-content">
                        <div class="modal-header" style="background-color: #367fa9; color: #fff;">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h3 class="modal-title">Chọn người vận chuyển</h3>
                        </div>
                        <div class="modal-body">
                            <div class="form-group" style="width: 95%">
                                <label for="">Ngày giờ chuyển</label>
                                <input class="form-control" type="datetime-local" id="ngayMua" ng-model="hoaDonVanChuyen.ngayGioVanChuyen" placeholder="" required>
                            </div>
                            <div class="form-group">
                                <label for="">Chọn người vận chuyển:</label>
                                <select class="form-control select2" style="width: 95%" ng-model="hoaDonVanChuyen.maNguoiVanChuyen" ng-options="item.MaNguoiVanChuyen as item.HoTen for item in model.JNguoiVanChuyen" required></select>
                            </div>
                            <div class="form-group" float: left;" style="width: 85%">
                                <label>Số giờ vận chuyển: </label>
                                <input type="number" min="1" value="1" class="form-control" ng-model="hoaDonVanChuyen.soGio" required>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default pull-left" data-dismiss="modal">Đóng</button>
                            <button type="submit" class="btn btn-primary" ng-click="chonNguoiVanChuyen()">Chọn</button>
                        </div>
                    </div>
                </form>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./Chọn người vận chuyển Modal *@

        @* Modal Delete hóa đơn xuất modal-danger3*@
        <div class="modal modal-danger fade" id="modal-danger3">
            <div class="modal-dialog">
                <form>
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            <h4 class="modal-title">Xác nhận thao tác xóa</h4>
                        </div>
                        <div class="modal-body">
                            <h3>Bạn có muốn xóa hóa đơn này?</h3>
                        </div>
                        <div class="modal-footer">
                            <input class="btn btn-outline pull-left" data-dismiss="modal" value="Hủy" style="width: 50px;">
                            <button type="submit" class="btn btn-outline" ng-click="xoaHoaDonXuat()" data-dismiss="modal">Thực hiện xóa</button>
                        </div>
                    </div>
                </form>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        @* ./Modal xóa hóa đơn xuất*@

        <div class="row">
            <div id="quan-ly-kho-header" class="col-xs-12 col-sm-12">
                <ul class="nav nav-tabs">
                    <li><a data-toggle="pill" href="#tonkho" ng-click="xem()">Xem tồn kho</a></li>
                    <li><a data-toggle="pill" href="#donhang" ng-click="xem()">Quản lý đơn đặt hàng</a></li>
                    <li><a data-toggle="pill" href="#quanlynhap" ng-click="xem()">Quản lý nhập</a></li>
                    <li><a data-toggle="pill" href="#quanlyxuat" ng-click="xem()">Quản lý xuất</a></li>
                    <li><a data-toggle="pill" href="#nhansu" ng-click="xem()">Nhân viên quản kho</a></li>
                </ul>
            </div>
        </div>

        <div class="row" id="quan-ly-kho">
            <div class="col-xs-12 danh-sach-muc">
                <div class="row-header">
                </div>
                <div class="box tab-content" style="border-top: none;">
                    @*Home*@
                    <div class="box-body tab-pane fade in active start" id="home">
                        <i class="fa fa-search start" aria-hidden="true"></i>
                        <span>Xin mời chọn kho để xem!</span>
                    </div>

                    @*Tồn kho*@
                    <div class="box-body tab-pane fade" id="tonkho">
                        <table id="example1" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tên đầu thuốc</th>
                                    <th>Thuộc nhóm</th>
                                    <th>Số lượng còn</th>
                                    <th>Đơn vị</th>
                                    @*<td></td>*@
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in JtonKho">
                                    <td class="col-md-1 col-xs-1"><a href="#">{{item.MaDT}}</a></td>
                                    <td class="col-md-3 col-xs-3">{{item.TenDauThuoc}}</td>
                                    <td class="col-md-3 col-xs-3"><span style="font-size: 15px;" ng-repeat="item1 in item.NhomDauThuoc">{{item1.TenNhom}}, </span></td>
                                    <td class="col-md-3 col-xs-3">{{item.SoLuongCon | number:2}}</td>
                                    @*<td class="col-md-2 col-xs-2">{{item.TenDonVi}}</td>*@
                                    <td class="col-md-2 col-xs-2">
                                        <select class="form-control select2" name="chonDonVi" style="width: 100%;" ng-mouseenter="getMaDonViOld(item.MaDonVi)" ng-change="chuyenDonVi(JtonKho.indexOf(item), item.MaDT, item.MaDonVi, item.SoLuongCon)" ng-options="item1.ID as item1.Ten for item1 in item.JDonVi" ng-model="item.MaDonVi"></select>
                                    </td>
                                    @*<td class="col-md-1 col-sm-1" style="text-align: center;">
                                        <a href='' ng-click="" data-toggle="modal" data-target="#modal-default1" style="padding: 0px 5px; font-size: 16px;"> <i class="fa fa-pencil"></i></a>
                                        <a href='' ng-click="" data-toggle="modal" data-target="#modal-danger1" style="padding: 0px 5px; font-size: 17px; color: red;"><i class="fa fa-trash-o"></i></a>
                                    </td>*@
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    @*Đơn hàng*@
                    <div class="box-body tab-pane fade" id="donhang">
                        <table id="example2" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Khách hàng</th>
                                    <th>Kho</th>
                                    <th>Tình trạng</th>
                                    <th>Người vận chuyển</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in JhoaDonMua">
                                    <td class="col-md-1 col-xs-1"><a href="ChiTietHoaDonMua/?mhd={{item.MaHD}}">{{item.MaHD}}</a></td>
                                    <td class="col-md-3 col-xs-3">{{item.TenKH}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.TenKho}}</td>
                                    <td class="col-md-2 col-xs-2"><a href="#" ng-click="kiemTraTrangThaiVanChuyen(item.MaHD)">{{item.TrangThai}}</a></td>
                                    <td class="col-md-2 col-xs-2">{{item.NguoiVanChuyen}}</td>
                                    <td class="col-md-2 col-sm-2" style="text-align: center;">
                                        <a class="btn btn-default" ng-click="taoPhieuXuat(item.MaHD)" data-toggle="modal">Tạo phiếu xuất <i class="fa fa-share-square-o"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    @*Quản lý nhập*@
                    <div class="box-body tab-pane fade" id="quanlynhap">
                        <a href="@Url.Action("themhoadonnhap","HoaDonNhap")" style="float: right; font-size: 25px; margin-right: 10px;"><i class="fa fa-plus-square-o"></i></a>
                        <table id="example3" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Người nhập</th>
                                    <th>Nhà sản xuất</th>
                                    <th>Ngày nhập</th>
                                    <th>Ghi chú</th>
                                    <td></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in Jnhap">
                                    <td class="col-md-1 col-xs-1"><a href="#">{{item.MaHD}}</a></td>
                                    <td class="col-md-2 col-xs-2">{{item.NguoiNhap}}</td>
                                    <td class="col-md-3 col-xs-3">{{item.NhaSanXuat}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.NgayXuat}}</td>
                                    <td class="col-md-3 col-xs-3">{{item.GhiChu}}</td>
                                    <td class="col-md-1 col-sm-1" style="text-align: center;">
                                        <a href='HoaDonNhap/suahoadonnhap?maHD={{item.MaHD}}' style="padding: 0px 5px; font-size: 16px;"> <i class="fa fa-pencil"></i></a>
                                        <a href='' ng-click="loadModalXoaHDN(item.MaHD)" style="padding: 0px 5px; font-size: 17px; color: red;"><i class="fa fa-trash-o"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    @*Quản lý xuất*@
                    <div class="box-body tab-pane fade" id="quanlyxuat">
                        <table id="example4" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Kho</th>
                                    <th>Người xuất</th>
                                    <th>Khách hàng</th>
                                    <th>Ngày xuất</th>
                                    <th>Người vận chuyển</th>
                                    <td></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in Jxuat">
                                    <td class="col-md-1 col-xs-1"><a href="#">{{item.MaHD}}</a></td>
                                    <td class="col-md-2 col-xs-2">{{item.TenKho}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.NguoiXuat}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.KhachHang}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.NgayXuat}}</td>
                                    <td class="col-md-2 col-xs-2"><a href="#" ng-click="kiemTraTrangThaiVanChuyen(item.MaHD)">{{item.NguoiVanChuyen === "" ? "Chọn người" : item.NguoiVanChuyen}}</a></td>
                                    <td class="col-md-1 col-sm-1" style="text-align: center;">
                                        @*<a href='' ng-click="" data-toggle="modal" data-target="" style="padding: 0px 5px; font-size: 16px;"> <i class="fa fa-pencil"></i></a>*@
                                        <a href='' ng-click="loadModalXoaHDX(item.MaHD)" data-toggle="modal" data-target="#modal-danger3" style="padding: 0px 5px; font-size: 17px; color: red;"><i class="fa fa-trash-o"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    @*Nhân viên qunr kho*@
                    <div class="box-body tab-pane fade" id="nhansu">
                        <table id="example5" class="table table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Mã Tài khoản</th>
                                    <th>Nhân viên</th>
                                    <th>Số điện thoại</th>
                                    <th>Email</th>
                                    <th>Chức vụ</th>
                                    <td></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="item in Jquankho">
                                    <td class="col-md-2 col-xs-2"><a href="#">{{item.MaTK}}</a></td>
                                    <td class="col-md-2 col-xs-2">{{item.HoTen}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.SDT}}</td>
                                    <td class="col-md-3 col-xs-3">{{item.Email}}</td>
                                    <td class="col-md-2 col-xs-2">{{item.ChucVu}}</td>
                                    <td class="col-md-1 col-sm-1" style="text-align: center;">
                                        <a href='' ng-click="" style="padding: 0px 5px; font-size: 16px;"> <i class="fa fa-pencil"></i></a>
                                        <a href='' ng-click="" style="padding: 0px 5px; font-size: 17px; color: red;"><i class="fa fa-trash-o"></i></a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <!-- /.col -->
        </div>
        <!-- /.row -->
    </section>
    <!-- /.content -->

</div>
